{"version":3,"file":"index-jODYUFAj.js","sources":["../../src/screens/CompendiumScreen.tsx","../../src/modals/InventoryModal.tsx","../../src/modals/SettingsModal.tsx","../../src/modals/HowToPlay.tsx","../../src/App.tsx","../../src/data/schemas/DjinnSchema.ts","../../src/data/schemas/EnemySchema.ts","../../src/data/schemas/EncounterSchema.ts","../../src/data/validateData.ts","../../src/main.tsx"],"sourcesContent":["/**\n * Compendium Screen Component\n * A read-only catalog showing Djinn, Units, and Equipment\n */\n\nimport { useState, useEffect } from 'preact/hooks';\nimport { useGameStore } from '../store/gameStore';\nimport { useStore } from '../ui/state/store';\nimport { DJINN } from '../data/definitions/djinn';\nimport { UNIT_DEFINITIONS } from '../data/definitions/units';\nimport { EQUIPMENT } from '../data/definitions/equipment';\nimport { ENEMIES } from '../data/definitions/enemies';\nimport type { Djinn } from '../data/schemas/DjinnSchema';\nimport type { UnitDefinition } from '../data/schemas/UnitSchema';\nimport type { Equipment } from '../data/schemas/EquipmentSchema';\nimport type { Enemy } from '../data/schemas/EnemySchema';\nimport { SimpleSprite } from '../ui/sprites/SimpleSprite';\nimport { EquipmentIcon } from '../ui/components/EquipmentIcon';\nimport { getPortraitSprite, getEnemyBattleSprite } from '../ui/sprites/mappings';\nimport './CompendiumScreen.css';\n\ntype TabType = 'djinn' | 'units' | 'enemies' | 'equipment';\n\nconst TABS = [\n  { id: 'djinn' as TabType, label: 'Djinn Collection', icon: '‚ú®' },\n  { id: 'units' as TabType, label: 'Unit Roster', icon: '‚öîÔ∏è' },\n  { id: 'enemies' as TabType, label: 'Enemies', icon: 'üëæ' },\n  { id: 'equipment' as TabType, label: 'Equipment Catalog', icon: 'üõ°Ô∏è' },\n];\n\n// Element color mapping\nconst ELEMENT_COLORS: Record<string, string> = {\n  Venus: '#9b6b3f',\n  Mars: '#d14545',\n  Mercury: '#4a90d9',\n  Jupiter: '#9b59b6',\n};\n\n// Get element color\nfunction getElementColor(element: string): string {\n  return ELEMENT_COLORS[element] || '#888';\n}\n\n// Djinn tier labels\nconst TIER_LABELS: Record<string, string> = {\n  '1': 'Tier 1',\n  '2': 'Tier 2',\n  '3': 'Tier 3',\n};\n\n// Equipment tier labels\nconst EQUIPMENT_TIER_LABELS: Record<string, string> = {\n  basic: 'Basic',\n  bronze: 'Bronze',\n  iron: 'Iron',\n  steel: 'Steel',\n  silver: 'Silver',\n  mythril: 'Mythril',\n  legendary: 'Legendary',\n  artifact: 'Artifact',\n};\n\n// Ownership Badge Component\nfunction OwnershipBadge({ isOwned }: { isOwned: boolean }) {\n  return (\n    <div class={`ownership-badge ${isOwned ? 'owned' : 'not-owned'}`}>\n      {isOwned ? '‚úì' : '?'}\n    </div>\n  );\n}\n\n// Djinn Card Component\nfunction DjinnCard({ djinn, isOwned }: { djinn: Djinn; isOwned: boolean }) {\n  const elementLower = djinn.element.toLowerCase();\n  return (\n    <div class={`compendium-card ${!isOwned ? 'not-owned' : ''}`} style={{ borderColor: getElementColor(djinn.element) }}>\n      <OwnershipBadge isOwned={isOwned} />\n      <div class=\"compendium-card-header\">\n        <h3 class=\"compendium-card-title\">{djinn.name}</h3>\n        <span class=\"compendium-card-element\" style={{ backgroundColor: getElementColor(djinn.element) }}>\n          {djinn.element}\n        </span>\n      </div>\n      <div class=\"compendium-card-sprite\">\n        <SimpleSprite\n          id={`${elementLower}-djinn-front`}\n          width={64}\n          height={64}\n        />\n      </div>\n      <div class=\"compendium-card-body\">\n        <div class=\"compendium-card-tier\">{TIER_LABELS[djinn.tier] || djinn.tier}</div>\n        {djinn.description && (\n          <p class=\"compendium-card-description\">{djinn.description}</p>\n        )}\n        <div class=\"compendium-card-section\">\n          <h4>Summon Effect</h4>\n          <p class=\"compendium-card-description\">{djinn.summonEffect.description}</p>\n          {djinn.summonEffect.type === 'damage' && djinn.summonEffect.damage && (\n            <p class=\"compendium-card-stat\">Damage: {djinn.summonEffect.damage}</p>\n          )}\n          {djinn.summonEffect.type === 'heal' && djinn.summonEffect.healAmount && (\n            <p class=\"compendium-card-stat\">Heal: {djinn.summonEffect.healAmount}</p>\n          )}\n          {djinn.summonEffect.type === 'buff' && djinn.summonEffect.statBonus && (\n            <p class=\"compendium-card-stat\">\n              Bonus: {Object.entries(djinn.summonEffect.statBonus).map(([stat, value]) => (stat.toUpperCase() + ' +' + value)).join(', ')}\n            </p>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Unit Card Component\nfunction UnitCard({ unit, isRecruited }: { unit: UnitDefinition; isRecruited: boolean }) {\n  const portraitId = getPortraitSprite(unit.id);\n  return (\n    <div class={`compendium-card ${!isRecruited ? 'not-owned' : ''}`} style={{ borderColor: getElementColor(unit.element) }}>\n      <OwnershipBadge isOwned={isRecruited} />\n      <div class=\"compendium-card-header\">\n        <h3 class=\"compendium-card-title\">{unit.name}</h3>\n        <span class=\"compendium-card-element\" style={{ backgroundColor: getElementColor(unit.element) }}>\n          {unit.element}\n        </span>\n      </div>\n      <div class=\"compendium-card-sprite\">\n        <SimpleSprite\n          id={portraitId}\n          width={64}\n          height={64}\n        />\n      </div>\n      <div class=\"compendium-card-body\">\n        <div class=\"compendium-card-role\">{unit.role}</div>\n        <p class=\"compendium-card-description\">{unit.description}</p>\n        <div class=\"compendium-card-section\">\n          <h4>Base Stats (Level 1)</h4>\n          <div class=\"compendium-card-stats\">\n            <div class=\"compendium-stat\">HP: {unit.baseStats.hp}</div>\n            <div class=\"compendium-stat\">PP: {unit.baseStats.pp}</div>\n            <div class=\"compendium-stat\">ATK: {unit.baseStats.atk}</div>\n            <div class=\"compendium-stat\">DEF: {unit.baseStats.def}</div>\n            <div class=\"compendium-stat\">MAG: {unit.baseStats.mag}</div>\n            <div class=\"compendium-stat\">SPD: {unit.baseStats.spd}</div>\n          </div>\n        </div>\n        <div class=\"compendium-card-section\">\n          <h4>Abilities</h4>\n          <p class=\"compendium-card-stat\">{unit.abilities.length} abilities available</p>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Equipment Card Component\nfunction EquipmentCard({ equipment, isOwned }: { equipment: Equipment; isOwned: boolean }) {\n  return (\n    <div class={`compendium-card ${!isOwned ? 'not-owned' : ''}`} style={{ borderColor: '#888' }}>\n      <OwnershipBadge isOwned={isOwned} />\n      <div class=\"compendium-card-header\">\n        <h3 class=\"compendium-card-title\">{equipment.name}</h3>\n        <span class=\"compendium-card-tier-badge\">\n          {EQUIPMENT_TIER_LABELS[equipment.tier] || equipment.tier}\n        </span>\n      </div>\n      <div class=\"compendium-card-sprite\">\n        <EquipmentIcon equipment={equipment} size=\"large\" />\n      </div>\n      <div class=\"compendium-card-body\">\n        <div class=\"compendium-card-slot\">{equipment.slot.toUpperCase()}</div>\n        <div class=\"compendium-card-section\">\n          <h4>Cost</h4>\n          <p class=\"compendium-card-stat\">{equipment.cost} Gold</p>\n        </div>\n        <div class=\"compendium-card-section\">\n          <h4>Stat Bonuses</h4>\n          <div class=\"compendium-card-stats\">\n            {Object.entries(equipment.statBonus).map(([stat, value]) => (\n              <div key={stat} class=\"compendium-stat\">\n                {stat.toUpperCase()}: {value > 0 ? '+' : ''}{value}\n              </div>\n            ))}\n          </div>\n        </div>\n        {equipment.allowedElements && equipment.allowedElements.length > 0 && (\n          <div class=\"compendium-card-section\">\n            <h4>Allowed Elements</h4>\n            <div class=\"compendium-element-tags\">\n              {equipment.allowedElements.map((element) => (\n                <span\n                  key={element}\n                  class=\"compendium-element-tag\"\n                  style={{ backgroundColor: getElementColor(element) }}\n                >\n                  {element}\n                </span>\n              ))}\n            </div>\n          </div>\n        )}\n        {equipment.unlocksAbility && (\n          <div class=\"compendium-card-section\">\n            <h4>Unlocks Ability</h4>\n            <p class=\"compendium-card-stat\">{equipment.unlocksAbility}</p>\n          </div>\n        )}\n        {equipment.elementalResist && (\n          <div class=\"compendium-card-section\">\n            <h4>Elemental Resist</h4>\n            <p class=\"compendium-card-stat\">{(equipment.elementalResist * 100).toFixed(0)}%</p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\n// Enemy Card Component\nfunction EnemyCard({ enemy }: { enemy: Enemy }) {\n  const spriteId = getEnemyBattleSprite(enemy.id, 'idle');\n  return (\n    <div class=\"compendium-card\" style={{ borderColor: getElementColor(enemy.element) }}>\n      <div class=\"compendium-card-header\">\n        <h3 class=\"compendium-card-title\">{enemy.name}</h3>\n        <span class=\"compendium-card-element\" style={{ backgroundColor: getElementColor(enemy.element) }}>\n          {enemy.element}\n        </span>\n      </div>\n      <div class=\"compendium-card-sprite\">\n        {spriteId ? (\n          <SimpleSprite\n            id={spriteId}\n            width={64}\n            height={64}\n          />\n        ) : (\n          <div class=\"compendium-card-stat\">Sprite missing</div>\n        )}\n      </div>\n      <div class=\"compendium-card-body\">\n        <div class=\"compendium-card-role\">Level {enemy.level}</div>\n        <div class=\"compendium-card-section\">\n          <h4>Base Stats</h4>\n          <div class=\"compendium-card-stats\">\n            <div class=\"compendium-stat\">HP: {enemy.stats.hp}</div>\n            <div class=\"compendium-stat\">PP: {enemy.stats.pp}</div>\n            <div class=\"compendium-stat\">ATK: {enemy.stats.atk}</div>\n            <div class=\"compendium-stat\">DEF: {enemy.stats.def}</div>\n            <div class=\"compendium-stat\">MAG: {enemy.stats.mag}</div>\n            <div class=\"compendium-stat\">SPD: {enemy.stats.spd}</div>\n          </div>\n        </div>\n        <div class=\"compendium-card-section\">\n          <h4>Abilities</h4>\n          <p class=\"compendium-card-stat\">{enemy.abilities.length} abilities available</p>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport function CompendiumScreen() {\n  const startTransition = useGameStore((s) => s.startTransition);\n  const [activeTab, setActiveTab] = useState<TabType>('djinn');\n  const [selectedIndex, setSelectedIndex] = useState(0);\n\n  // Get player ownership data from store\n  const { team, roster, equipment: ownedEquipment } = useStore((s) => ({\n    team: s.team,\n    roster: s.roster,\n    equipment: s.equipment,\n  }));\n\n  // Build lookup sets for efficient ownership checks\n  const collectedDjinnIds = new Set(team?.collectedDjinn || []);\n  const recruitedUnitIds = new Set(roster.map((u) => u.id));\n  const ownedEquipmentIds = new Set(ownedEquipment.map((e) => e.id));\n\n  // Get data for current tab - filter out tower-exclusive content\n  const djinnList = Object.values(DJINN).filter(d => !d.availableIn || d.availableIn.length === 0);\n  const unitsList = Object.values(UNIT_DEFINITIONS).filter(u => !u.availableIn || u.availableIn.length === 0);\n  const enemiesList = Object.values(ENEMIES);\n  const equipmentList = Object.values(EQUIPMENT).filter(e => !e.availableIn || e.availableIn.length === 0);\n\n  // Get current list based on active tab\n  const getCurrentList = () => {\n    switch (activeTab) {\n      case 'djinn':\n        return djinnList;\n      case 'units':\n        return unitsList;\n      case 'enemies':\n        return enemiesList;\n      case 'equipment':\n        return equipmentList;\n      default:\n        return [];\n    }\n  };\n\n  const currentList = getCurrentList();\n\n  // Reset selected index when tab changes\n  useEffect(() => {\n    setSelectedIndex(0);\n  }, [activeTab]);\n\n  // Keyboard navigation\n  useEffect(() => {\n    const handleKeyPress = (event: KeyboardEvent) => {\n      // ESC to return to menu\n      if (event.key === 'Escape') {\n        event.preventDefault();\n        startTransition('menu');\n        return;\n      }\n\n      // Tab navigation: Q/E or Left/Right arrows\n      if (event.key === 'q' || event.key === 'Q') {\n        event.preventDefault();\n        const currentTabIndex = TABS.findIndex(tab => tab.id === activeTab);\n        const prevTabIndex = currentTabIndex > 0 ? currentTabIndex - 1 : TABS.length - 1;\n        const prevTab = TABS[prevTabIndex];\n        if (prevTab?.id) setActiveTab(prevTab.id);\n        return;\n      }\n\n      if (event.key === 'e' || event.key === 'E') {\n        event.preventDefault();\n        const currentTabIndex = TABS.findIndex(tab => tab.id === activeTab);\n        const nextTabIndex = currentTabIndex < TABS.length - 1 ? currentTabIndex + 1 : 0;\n        const nextTab = TABS[nextTabIndex];\n        if (nextTab?.id) setActiveTab(nextTab.id);\n        return;\n      }\n\n      // Arrow navigation for cards\n      if (event.key === 'ArrowUp') {\n        event.preventDefault();\n        setSelectedIndex((prev) => (prev > 0 ? prev - 1 : currentList.length - 1));\n        return;\n      }\n\n      if (event.key === 'ArrowDown') {\n        event.preventDefault();\n        setSelectedIndex((prev) => (prev < currentList.length - 1 ? prev + 1 : 0));\n        return;\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyPress);\n    return () => window.removeEventListener('keydown', handleKeyPress);\n  }, [activeTab, currentList.length, startTransition]);\n\n  // Render cards based on active tab\n  const renderContent = () => {\n    switch (activeTab) {\n      case 'djinn':\n        return (\n          <div class=\"compendium-grid\">\n            {djinnList.map((djinn, index) => (\n              <div key={djinn.id} class={selectedIndex === index ? 'selected' : ''}>\n                <DjinnCard djinn={djinn} isOwned={collectedDjinnIds.has(djinn.id)} />\n              </div>\n            ))}\n          </div>\n        );\n      case 'units':\n        return (\n          <div class=\"compendium-grid\">\n            {unitsList.map((unit, index) => (\n              <div key={unit.id} class={selectedIndex === index ? 'selected' : ''}>\n                <UnitCard unit={unit} isRecruited={recruitedUnitIds.has(unit.id)} />\n              </div>\n            ))}\n          </div>\n        );\n      case 'enemies':\n        return (\n          <div class=\"compendium-grid\">\n            {enemiesList.map((enemy, index) => (\n              <div key={enemy.id} class={selectedIndex === index ? 'selected' : ''}>\n                <EnemyCard enemy={enemy} />\n              </div>\n            ))}\n          </div>\n        );\n      case 'equipment':\n        return (\n          <div class=\"compendium-grid\">\n            {equipmentList.map((equipment, index) => (\n              <div key={equipment.id} class={selectedIndex === index ? 'selected' : ''}>\n                <EquipmentCard equipment={equipment} isOwned={ownedEquipmentIds.has(equipment.id)} />\n              </div>\n            ))}\n          </div>\n        );\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <div class=\"compendium-screen\">\n      <div class=\"compendium-header\">\n        <h1 class=\"compendium-title\">Compendium</h1>\n        <div class=\"compendium-tabs\">\n          {TABS.map((tab) => (\n            <button\n              key={tab.id}\n              class={`compendium-tab ${activeTab === tab.id ? 'active' : ''}`}\n              onClick={() => setActiveTab(tab.id)}\n            >\n              <span class=\"compendium-tab-icon\">{tab.icon}</span>\n              <span class=\"compendium-tab-label\">{tab.label}</span>\n            </button>\n          ))}\n        </div>\n      </div>\n\n      <div class=\"compendium-content\">\n        {renderContent()}\n      </div>\n\n      <div class=\"compendium-footer\">\n        <div class=\"compendium-help\">\n          <span>Q/E: Switch Tabs</span>\n          <span>‚Üë/‚Üì: Navigate</span>\n          <span>ESC: Return to Menu</span>\n        </div>\n        <div class=\"compendium-count\">\n          {currentList.length} {activeTab === 'djinn' ? 'Djinn' : activeTab === 'units' ? 'Units' : activeTab === 'enemies' ? 'Enemies' : 'Items'}\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { FunctionComponent } from 'preact';\nimport { useState } from 'preact/hooks';\nimport { useStore } from '../ui/state/store';\n\ninterface InventoryModalProps {\n  onClose?: () => void;\n}\n\nexport const InventoryModal: FunctionComponent<InventoryModalProps> = ({ onClose }) => {\n  const { gold, equipment } = useStore((s) => ({\n    gold: s.gold,\n    equipment: s.equipment,\n  }));\n\n  const [selectedItemId, setSelectedItemId] = useState<string | null>(null);\n\n  const selectedItem = equipment.find((item) => item.id === selectedItemId);\n\n  return (\n    <div class=\"modal-overlay\" onClick={onClose}>\n      <div class=\"modal modal--inventory\" onClick={(e) => e.stopPropagation()}>\n        <div class=\"modal-header\">\n          <h2>Inventory</h2>\n          <button class=\"close-btn\" onClick={onClose} aria-label=\"Close inventory\">\n            √ó\n          </button>\n        </div>\n\n        <div class=\"modal-content\">\n          <div class=\"inventory-stats\">\n            <div class=\"stat-item\">\n              <span class=\"stat-label\">Gold:</span>\n              <span class=\"stat-value\">{gold.toLocaleString()}</span>\n            </div>\n            <div class=\"stat-item\">\n              <span class=\"stat-label\">Equipment:</span>\n              <span class=\"stat-value\">{equipment.length} items</span>\n            </div>\n          </div>\n\n          <div class=\"inventory-content\">\n            <div class=\"equipment-list\">\n              {equipment.length === 0 ? (\n                <div class=\"empty-message\">No equipment in inventory</div>\n              ) : (\n                equipment.map((item) => {\n                  const isSelected = selectedItemId === item.id;\n\n                  return (\n                    <div\n                      key={item.id}\n                      class={`equipment-item ${isSelected ? 'selected' : ''}`}\n                      onClick={() => setSelectedItemId(item.id)}\n                    >\n                      <div class=\"item-icon\">{item.slot === 'weapon' ? '‚öîÔ∏è' : 'üõ°Ô∏è'}</div>\n                      <div class=\"item-info\">\n                        <div class=\"item-name\">{item.name}</div>\n                        <div class=\"item-type\">{item.slot}</div>\n                      </div>\n                      <div class=\"item-stats\">\n                        {(item.statBonus.atk ?? 0) > 0 && <span class=\"stat-bonus\">ATK +{item.statBonus.atk}</span>}\n                        {(item.statBonus.def ?? 0) > 0 && <span class=\"stat-bonus\">DEF +{item.statBonus.def}</span>}\n                        {(item.statBonus.mag ?? 0) > 0 && <span class=\"stat-bonus\">MAG +{item.statBonus.mag}</span>}\n                        {(item.statBonus.spd ?? 0) > 0 && <span class=\"stat-bonus\">SPD +{item.statBonus.spd}</span>}\n                      </div>\n                    </div>\n                  );\n                })\n              )}\n            </div>\n\n            {selectedItem && (\n              <div class=\"item-details\">\n                <h3>{selectedItem.name}</h3>\n                <div class=\"detail-row\">\n                  <span class=\"detail-label\">Type:</span>\n                  <span class=\"detail-value\">{selectedItem.slot}</span>\n                </div>\n                <div class=\"detail-row\">\n                  <span class=\"detail-label\">Bonuses:</span>\n                  <div class=\"detail-bonuses\">\n                    {(selectedItem.statBonus.atk ?? 0) > 0 && <div>Attack: +{selectedItem.statBonus.atk}</div>}\n                    {(selectedItem.statBonus.def ?? 0) > 0 && <div>Defense: +{selectedItem.statBonus.def}</div>}\n                    {(selectedItem.statBonus.mag ?? 0) > 0 && <div>Magic: +{selectedItem.statBonus.mag}</div>}\n                    {(selectedItem.statBonus.spd ?? 0) > 0 && <div>Speed: +{selectedItem.statBonus.spd}</div>}\n                    {(selectedItem.statBonus.hp ?? 0) > 0 && <div>HP: +{selectedItem.statBonus.hp}</div>}\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n\n          <div class=\"inventory-footer\">\n            <button class=\"btn btn-secondary\" onClick={onClose}>\n              Close\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n","import { FunctionComponent } from 'preact';\nimport { useState } from 'preact/hooks';\n\ninterface SettingsModalProps {\n  onClose?: () => void;\n}\n\nexport const SettingsModal: FunctionComponent<SettingsModalProps> = ({ onClose }) => {\n  // Local state for settings (could be moved to global store later)\n  const [musicVolume, setMusicVolume] = useState(70);\n  const [sfxVolume, setSfxVolume] = useState(80);\n  const [battleSpeed, setBattleSpeed] = useState<'slow' | 'normal' | 'fast'>('normal');\n  const [showDamageNumbers, setShowDamageNumbers] = useState(true);\n  const [autoSave, setAutoSave] = useState(true);\n\n  return (\n    <div class=\"modal-overlay\" onClick={onClose}>\n      <div class=\"modal modal--settings\" onClick={(e) => e.stopPropagation()}>\n        <div class=\"modal-header\">\n          <h2>Settings</h2>\n          <button class=\"close-btn\" onClick={onClose} aria-label=\"Close settings\">\n            √ó\n          </button>\n        </div>\n\n        <div class=\"modal-content\">\n          <section class=\"settings-section\">\n            <h3>Audio</h3>\n\n            <div class=\"setting-item\">\n              <label class=\"setting-label\" for=\"music-volume\">\n                Music Volume: {musicVolume}%\n              </label>\n              <input\n                id=\"music-volume\"\n                type=\"range\"\n                min=\"0\"\n                max=\"100\"\n                value={musicVolume}\n                onInput={(e) => setMusicVolume(parseInt((e.target as HTMLInputElement).value))}\n                class=\"setting-slider\"\n              />\n            </div>\n\n            <div class=\"setting-item\">\n              <label class=\"setting-label\" for=\"sfx-volume\">\n                Sound Effects: {sfxVolume}%\n              </label>\n              <input\n                id=\"sfx-volume\"\n                type=\"range\"\n                min=\"0\"\n                max=\"100\"\n                value={sfxVolume}\n                onInput={(e) => setSfxVolume(parseInt((e.target as HTMLInputElement).value))}\n                class=\"setting-slider\"\n              />\n            </div>\n          </section>\n\n          <section class=\"settings-section\">\n            <h3>Gameplay</h3>\n\n            <div class=\"setting-item\">\n              <label class=\"setting-label\">Battle Speed</label>\n              <div class=\"setting-buttons\">\n                <button\n                  class={`setting-btn ${battleSpeed === 'slow' ? 'active' : ''}`}\n                  onClick={() => setBattleSpeed('slow')}\n                >\n                  Slow\n                </button>\n                <button\n                  class={`setting-btn ${battleSpeed === 'normal' ? 'active' : ''}`}\n                  onClick={() => setBattleSpeed('normal')}\n                >\n                  Normal\n                </button>\n                <button\n                  class={`setting-btn ${battleSpeed === 'fast' ? 'active' : ''}`}\n                  onClick={() => setBattleSpeed('fast')}\n                >\n                  Fast\n                </button>\n              </div>\n            </div>\n\n            <div class=\"setting-item\">\n              <label class=\"setting-checkbox\">\n                <input\n                  type=\"checkbox\"\n                  checked={showDamageNumbers}\n                  onChange={(e) => setShowDamageNumbers((e.target as HTMLInputElement).checked)}\n                />\n                <span>Show Damage Numbers</span>\n              </label>\n            </div>\n\n            <div class=\"setting-item\">\n              <label class=\"setting-checkbox\">\n                <input\n                  type=\"checkbox\"\n                  checked={autoSave}\n                  onChange={(e) => setAutoSave((e.target as HTMLInputElement).checked)}\n                />\n                <span>Auto-Save After Battles</span>\n              </label>\n            </div>\n          </section>\n\n          <section class=\"settings-section\">\n            <h3>Display</h3>\n            <div class=\"setting-info\">\n              Resolution: {window.innerWidth} √ó {window.innerHeight}\n            </div>\n          </section>\n\n          <div class=\"settings-footer\">\n            <button class=\"btn btn-primary\" onClick={onClose}>\n              Apply & Close\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n","import { FunctionComponent } from 'preact';\n\ninterface HowToPlayProps {\n  onClose: () => void;\n}\n\nexport const HowToPlay: FunctionComponent<HowToPlayProps> = ({ onClose }) => {\n  return (\n    <div class=\"modal-overlay\" onClick={onClose}>\n      <div class=\"modal modal--help\" onClick={(e) => e.stopPropagation()}>\n        <div class=\"modal-header\">\n          <h2>How to Play</h2>\n          <button class=\"close-btn\" onClick={onClose} aria-label=\"Close help\">\n            √ó\n          </button>\n        </div>\n\n        <div class=\"modal-content\">\n          <section class=\"help-section\">\n            <h3>Game Overview</h3>\n            <p>\n              Vale Village is a Golden Sun-inspired RPG where you build a team of heroes,\n              collect Djinn, and battle through challenging encounters.\n            </p>\n          </section>\n\n          <section class=\"help-section\">\n            <h3>Battle System</h3>\n            <ul>\n              <li><strong>Turn-Based Combat:</strong> Select actions for each unit in turn order</li>\n              <li><strong>Abilities:</strong> Each unit has unique abilities that cost mana</li>\n              <li><strong>Djinn:</strong> Summon Djinn to provide team-wide stat bonuses</li>\n              <li><strong>Elements:</strong> Venus, Mars, Mercury, and Jupiter - each with strengths</li>\n            </ul>\n          </section>\n\n          <section class=\"help-section\">\n            <h3>Team Management</h3>\n            <ul>\n              <li><strong>Roster:</strong> Recruit units and view their stats in the Unit Compendium</li>\n              <li><strong>Formation:</strong> Select your battle formation before each encounter</li>\n              <li><strong>Equipment:</strong> Equip items to boost unit stats</li>\n            </ul>\n          </section>\n\n          <section class=\"help-section\">\n            <h3>Djinn System</h3>\n            <ul>\n              <li><strong>Collecting:</strong> Find Djinn throughout your journey</li>\n              <li><strong>States:</strong> Set (passive bonuses) or Standby (ready to summon)</li>\n              <li><strong>Summoning:</strong> Use Djinn in battle for powerful effects</li>\n              <li><strong>Team Slots:</strong> Equip up to 3 Djinn for global team bonuses</li>\n            </ul>\n          </section>\n\n          <section class=\"help-section\">\n            <h3>Keyboard Controls</h3>\n            <ul>\n              <li><strong>Arrow Keys:</strong> Navigate menus and select targets</li>\n              <li><strong>Enter/Space:</strong> Confirm selection</li>\n              <li><strong>Escape:</strong> Cancel or open pause menu</li>\n              <li><strong>1-9:</strong> Quick select abilities in battle</li>\n            </ul>\n          </section>\n\n          <section class=\"help-section\">\n            <h3>Pause Menu Shortcuts</h3>\n            <ul>\n              <li><strong>T:</strong> Team Management</li>\n              <li><strong>I:</strong> Inventory</li>\n              <li><strong>D:</strong> Djinn Collection</li>\n              <li><strong>S:</strong> Save Game</li>\n              <li><strong>O:</strong> Settings</li>\n              <li><strong>H:</strong> How to Play</li>\n              <li><strong>Q:</strong> Return to Title</li>\n            </ul>\n          </section>\n\n          <div class=\"help-footer\">\n            <button class=\"btn btn-primary\" onClick={onClose}>\n              Got It!\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n","import { FunctionComponent, JSX } from 'preact';\nimport { useState, useEffect } from 'preact/hooks';\nimport { shallow } from 'zustand/shallow';\n\nimport { useGameStore, ScreenType, ModalType, GameStore } from './store/gameStore';\n\nimport { TitleScreen } from './screens/TitleScreen';\nimport { OverworldMap } from './screens/OverworldMap';\nimport { QueueBattleView } from './screens/QueueBattleView';\nimport { MainMenu } from './screens/MainMenu';\nimport { CompendiumScreen } from './screens/CompendiumScreen';\nimport { PreBattleTeamSelectScreenV2 } from './ui/components/PreBattleTeamSelectScreenV2';\nimport { RewardsScreen } from './ui/components/RewardsScreen';\nimport { ShopScreen } from './ui/components/ShopScreen';\nimport { TowerHubScreen } from './ui/components/TowerHubScreen';\nimport { CreditsScreen } from './ui/components/CreditsScreen';\nimport { EpilogueScreen } from './ui/components/EpilogueScreen';\nimport { useStore, store } from './ui/state/store';\n\n// Wrapper that reads team-select props from V1 store\nconst TeamSelectWrapper: FunctionComponent = () => {\n  const { pendingBattleEncounterId, confirmBattleTeam, returnToOverworld } = useStore((s) => ({\n    pendingBattleEncounterId: s.pendingBattleEncounterId,\n    confirmBattleTeam: s.confirmBattleTeam,\n    returnToOverworld: s.returnToOverworld,\n  }));\n  const startTransition = useGameStore((s) => s.startTransition);\n\n  const handleConfirm = () => {\n    confirmBattleTeam();\n    startTransition('battle');\n  };\n\n  const handleCancel = () => {\n    returnToOverworld();\n    startTransition('menu');\n  };\n\n  if (!pendingBattleEncounterId) {\n    // No pending battle, show loading or redirect\n    return <div style={{ color: '#fff', textAlign: 'center', padding: '2rem' }}>No battle pending...</div>;\n  }\n\n  return (\n    <PreBattleTeamSelectScreenV2\n      encounterId={pendingBattleEncounterId}\n      onConfirm={handleConfirm}\n      onCancel={handleCancel}\n    />\n  );\n};\n\n// Wrapper that reads rewards props from V1 store\nconst RewardsWrapper: FunctionComponent = () => {\n  const { lastBattleRewards, team, claimRewards, selectEquipmentChoice, returnToOverworld, setBattle, towerStatus, setMode } = useStore((s) => ({\n    lastBattleRewards: s.lastBattleRewards,\n    team: s.team,\n    claimRewards: s.claimRewards,\n    selectEquipmentChoice: s.selectEquipmentChoice,\n    returnToOverworld: s.returnToOverworld,\n    setBattle: s.setBattle,\n    towerStatus: s.towerStatus,\n    setMode: s.setMode,\n  }));\n  const startTransition = useGameStore((s) => s.startTransition);\n\n  const handleRewardsContinue = () => {\n    claimRewards();\n    setBattle(null, 0);\n\n    // Clear the stored encounterId after using it (if needed in future)\n    store.setState({ lastBattleEncounterId: null });\n\n    // Check if we're in tower mode - if so, return to tower hub instead of overworld\n    if (towerStatus === 'in-run' || towerStatus === 'completed') {\n      setMode('tower');\n      startTransition('tower');\n    } else {\n      // Return to overworld for normal battles\n      returnToOverworld();\n      startTransition('overworld');\n    }\n  };\n\n  if (!lastBattleRewards || !team) {\n    return <div style={{ color: '#fff', textAlign: 'center', padding: '2rem' }}>No rewards available...</div>;\n  }\n\n  return (\n    <RewardsScreen\n      rewards={lastBattleRewards}\n      team={team}\n      onContinue={handleRewardsContinue}\n      onSelectEquipment={selectEquipmentChoice}\n    />\n  );\n};\n\n// Wrapper that reads shop props from V1 store\nconst ShopWrapper: FunctionComponent = () => {\n  const { currentShopId, returnToOverworld } = useStore((s) => ({\n    currentShopId: s.currentShopId,\n    returnToOverworld: s.returnToOverworld,\n  }));\n  const startTransition = useGameStore((s) => s.startTransition);\n\n  const handleClose = () => {\n    returnToOverworld();\n    startTransition('overworld');\n  };\n\n  if (!currentShopId) {\n    // No shop ID, redirect to overworld\n    return <div style={{ color: '#fff', textAlign: 'center', padding: '2rem' }}>No shop available...</div>;\n  }\n\n  return <ShopScreen shopId={currentShopId} onClose={handleClose} />;\n};\n\nimport { PauseMenu } from './modals/PauseMenu';\nimport { DialogueBox } from './modals/DialogueBox';\nimport { InventoryModal } from './modals/InventoryModal';\nimport { SettingsModal } from './modals/SettingsModal';\nimport { SaveMenu } from './ui/components/SaveMenu';\nimport { HowToPlay } from './modals/HowToPlay';\nimport { PartyManagementScreen } from './ui/components/PartyManagementScreen';\nimport { DjinnCollectionScreen } from './ui/components/DjinnCollectionScreen';\n\nimport './index.css';\n\n// Global sync: V1 store mode ‚Üí V2 gameStore screen\n// This ensures tower battles return to tower hub correctly\nfunction useStoreSync() {\n  const mode = useStore((s) => s.mode);\n  const towerStatus = useStore((s) => s.towerStatus);\n  const showCredits = useStore((s) => s.showCredits);\n  const setShowCredits = useStore((s) => s.setShowCredits);\n  const setScreen = useGameStore((s) => s.setScreen);\n  const startTransition = useGameStore((s) => s.startTransition);\n\n  useEffect(() => {\n    // Only sync tower mode - other modes are handled by their respective components\n    if (mode === 'tower' && (towerStatus === 'in-run' || towerStatus === 'completed' || towerStatus === 'idle')) {\n      setScreen('tower');\n    }\n  }, [mode, towerStatus, setScreen]);\n\n  // Sync showCredits flag to credits screen\n  useEffect(() => {\n    if (showCredits) {\n      startTransition('credits');\n      // Reset the flag so it doesn't re-trigger\n      setShowCredits(false);\n    }\n  }, [showCredits, startTransition, setShowCredits]);\n}\n\ntype DevOverlayProps = {\n  screen: ScreenType;\n  modal: ModalType | null;\n};\n\nconst DevOverlay: FunctionComponent<DevOverlayProps> = ({ screen, modal }) => (\n  <div className=\"dev-overlay\">\n    <div className=\"dev-overlay__panel\">\n      <div className=\"dev-overlay__header\">Dev Mode</div>\n      <div className=\"dev-overlay__row\">\n        <span>Screen: {screen}</span>\n        <span>Modal: {modal ?? 'none'}</span>\n      </div>\n      <div className=\"dev-overlay__row\">\n        <span>F1</span>\n        <span>Toggle dev overlay</span>\n      </div>\n      <div className=\"dev-overlay__row\">\n        <span>1 / 2 / 3 / 4</span>\n        <span>title / overworld / battle / menu</span>\n      </div>\n      <div className=\"dev-overlay__row\">\n        <span>I / O / P / D</span>\n        <span>inventory / settings / pause / dialogue modal</span>\n      </div>\n      <div className=\"dev-overlay__row\">\n        <span>Esc</span>\n        <span>Close active modal</span>\n      </div>\n    </div>\n  </div>\n);\n\nconst App: FunctionComponent = () => {\n  // Sync V1 store mode to V2 gameStore screen\n  useStoreSync();\n\n  const { screen, modal, isTransitioning, setScreen, startTransition, openModal, closeModal } = useGameStore(\n    (state: GameStore) => ({\n      screen: state.flow.screen,\n      modal: state.flow.modal,\n      isTransitioning: state.flow.isTransitioning,\n      setScreen: state.setScreen,\n      startTransition: state.startTransition,\n      openModal: state.openModal,\n      closeModal: state.closeModal,\n    }),\n    shallow\n  );\n\n  const setModal = (m: ModalType | null) => {\n    if (m === null) {\n      closeModal();\n    } else {\n      openModal(m);\n    }\n  };\n\n  const [isDevMode, setIsDevMode] = useState<boolean>(false);\n\n  useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent): void => {\n      if (event.key === 'F1') {\n        event.preventDefault();\n        setIsDevMode((value) => !value);\n        return;\n      }\n\n      // Inventory shortcut 'I' - works on overworld/menu screens regardless of dev mode\n      if (event.code === 'KeyI' && !isDevMode) {\n        const allowedScreens: ScreenType[] = ['overworld', 'menu', 'team-management', 'djinn-collection'];\n        if (allowedScreens.includes(screen)) {\n          event.preventDefault();\n          setModal('inventory');\n        }\n        return;\n      }\n\n      if (!isDevMode) {\n        return;\n      }\n\n      switch (event.code) {\n        case 'Digit1':\n          startTransition('title');\n          break;\n        case 'Digit2':\n          startTransition('overworld');\n          break;\n        case 'Digit3':\n          startTransition('battle');\n          break;\n        case 'Digit4':\n          startTransition('menu');\n          break;\n        case 'KeyI':\n          setModal('inventory');\n          break;\n        case 'KeyO':\n          setModal('settings');\n          break;\n        case 'KeyP':\n          setModal('pause');\n          break;\n        case 'KeyD':\n          setModal('dialogue');\n          break;\n        case 'Escape':\n          setModal(null);\n          break;\n        default:\n          break;\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [isDevMode, screen, setScreen, setModal]);\n\n  const renderScreen = (): JSX.Element => {\n    switch (screen) {\n      case 'title':\n        return <TitleScreen />;\n      case 'overworld':\n        return <OverworldMap />;\n      case 'battle':\n        return <QueueBattleView />;\n      case 'menu':\n        return <MainMenu />;\n      case 'compendium':\n        return <CompendiumScreen />;\n      case 'team-select':\n        return <TeamSelectWrapper />;\n      case 'rewards':\n        return <RewardsWrapper />;\n      case 'shop':\n        return <ShopWrapper />;\n      case 'team-management':\n        return <PartyManagementScreen onClose={() => startTransition('overworld')} />;\n      case 'djinn-collection':\n        return <DjinnCollectionScreen onClose={() => startTransition('overworld')} />;\n      case 'tower':\n        return <TowerHubScreen />;\n      case 'credits':\n        return <CreditsScreen onExit={() => startTransition('epilogue')} />;\n      case 'epilogue':\n        return <EpilogueScreen onComplete={() => startTransition('title')} />;\n      default:\n        return <TitleScreen />;\n    }\n  };\n\n  const renderModal = (): JSX.Element | null => {\n    if (!modal) {\n      return null;\n    }\n\n    switch (modal) {\n      case 'inventory':\n        return <InventoryModal onClose={closeModal} />;\n      case 'settings':\n        return <SettingsModal onClose={closeModal} />;\n      case 'dialogue':\n        return <DialogueBox />;\n      case 'save':\n        return <SaveMenu onClose={closeModal} />;\n      case 'help':\n        return <HowToPlay onClose={closeModal} />;\n      case 'pause':\n        return <PauseMenu\n          onClose={closeModal}\n          onTeamManagement={() => {\n            closeModal();\n            startTransition('team-management');\n          }}\n          onInventory={() => {\n            closeModal();\n            openModal('inventory');\n          }}\n          onDjinnCollection={() => {\n            closeModal();\n            startTransition('djinn-collection');\n          }}\n          onSaveGame={() => {\n            closeModal();\n            openModal('save');\n          }}\n          onSettings={() => {\n            closeModal();\n            openModal('settings');\n          }}\n          onHowToPlay={() => {\n            closeModal();\n            openModal('help');\n          }}\n          onReturnToTitle={() => {\n            closeModal();\n            startTransition('title');\n          }}\n        />;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <div className={`app-root${isTransitioning ? ' app-root--transitioning' : ''}`}>\n      {renderScreen()}\n      {renderModal()}\n      {isDevMode && <DevOverlay screen={screen} modal={modal} />}\n    </div>\n  );\n};\n\nexport { App };\nexport default App;\n","import { z } from 'zod';\nimport { ElementSchema } from './UnitSchema';\nimport { ContentAvailabilitySchema } from './ContentAvailabilitySchema';\n\nexport const DjinnSummonEffectSchema = z.discriminatedUnion('type', [\n  z.object({\n    type: z.literal('damage'),\n    description: z.string(),\n    damage: z.number().int().min(0),\n  }),\n  z.object({\n    type: z.literal('heal'),\n    description: z.string(),\n    healAmount: z.number().int().min(0),\n  }),\n  z.object({\n    type: z.literal('buff'),\n    description: z.string(),\n    statBonus: z.object({\n      atk: z.number().optional(),\n      def: z.number().optional(),\n      mag: z.number().optional(),\n      spd: z.number().optional(),\n    }),\n  }),\n  z.object({\n    type: z.literal('special'),\n    description: z.string(),\n  }),\n]);\n\nexport const DjinnGrantedAbilitiesSchema = z.object({\n  same: z.array(z.string()).min(0).max(4),\n  counter: z.array(z.string()).min(0).max(4),\n  neutral: z.array(z.string()).min(0).max(4),\n});\nexport const DjinnSchema = z.object({\n  id: z.string().min(1),\n  name: z.string().min(1),\n  element: ElementSchema,\n  tier: z.enum(['1', '2', '3']),\n  description: z.string().optional(), // Lore/flavor text about the Djinn\n  summonEffect: DjinnSummonEffectSchema,\n  grantedAbilities: z.record(z.string().min(1), DjinnGrantedAbilitiesSchema),\n  availableIn: ContentAvailabilitySchema.optional().readonly(),\n});\n\nexport type Djinn = z.infer<typeof DjinnSchema>;\nexport type DjinnSummonEffect = z.infer<typeof DjinnSummonEffectSchema>;\n","import { z } from 'zod';\nimport { StatsSchema } from './StatsSchema';\nimport { ElementSchema } from './UnitSchema';\nimport { AbilitySchema } from './AbilitySchema';\nimport { EquipmentSchema } from './EquipmentSchema';\n\n/**\n * Zod schema for Equipment drop\n */\nexport const EquipmentDropSchema = z.object({\n  equipment: EquipmentSchema,\n  chance: z.number().min(0).max(1), // 0.0 to 1.0 (0% to 100%)\n});\n\n/**\n * Zod schema for Enemy\n * Enemies are similar to Units but simpler:\n * - No equipment or Djinn\n * - Fixed stats (no growth rates)\n * - Reward data for XP and Gold\n * - Optional equipment drops with chances\n */\nexport const EnemySchema = z.object({\n  id: z.string().min(1),\n  name: z.string().min(1),\n  level: z.number().int().min(1).max(20),  // Levels 1-20\n  stats: StatsSchema,\n  abilities: z.array(AbilitySchema).min(1),  // At least 1 ability\n  element: ElementSchema,\n  baseXp: z.number().int().min(0),\n  baseGold: z.number().int().min(0),\n  drops: z.array(EquipmentDropSchema).optional(),\n});\n\nexport type Enemy = z.infer<typeof EnemySchema>;\nexport type EquipmentDrop = z.infer<typeof EquipmentDropSchema>;\n\n","import { z } from 'zod';\n\n/**\n * Zod schema for Encounter rules\n * Encounters can have special rules like phase changes, etc.\n */\nexport const EncounterRulesSchema = z.object({\n  phaseChange: z\n    .object({\n      hpPct: z.number().min(0).max(1), // HP percentage threshold (0.0 to 1.0)\n      addAbility: z.string().min(1), // Ability ID to add at phase change\n    })\n    .optional(),\n});\n\nconst equipmentOptionsUnique = (options: readonly string[]) => new Set(options).size === options.length;\n\nexport const EquipmentRewardSchema = z.discriminatedUnion('type', [\n  z.object({\n    type: z.literal('none'),\n  }),\n  z.object({\n    type: z.literal('fixed'),\n    itemId: z.string().min(1),\n  }),\n  z.object({\n    type: z.literal('choice'),\n    options: z\n      .array(z.string().min(1))\n      .length(3)\n      .refine(equipmentOptionsUnique, {\n        message: 'Choice options must be unique',\n      }),\n  }),\n]);\n\nexport const EncounterRewardsSchema = z.object({\n  xp: z.number().int().min(0),\n  gold: z.number().int().min(0),\n  equipment: EquipmentRewardSchema,\n  djinn: z.string().min(1).optional(), // Djinn ID to award\n  unlockUnit: z.string().min(1).optional(),\n  unlockAbility: z.string().min(1).optional(), // Future: apply unlocks in RewardsService/Store\n});\n\nexport const EncounterSchema = z.object({\n  id: z.string().min(1),\n  name: z.string().min(1),\n  enemies: z.array(z.string().min(1)).min(1),\n  difficulty: z.enum(['easy', 'medium', 'hard', 'boss']).optional(),\n  rules: EncounterRulesSchema.optional(),\n  reward: EncounterRewardsSchema,\n});\n\nexport type Encounter = z.infer<typeof EncounterSchema>;\nexport type EncounterRules = z.infer<typeof EncounterRulesSchema>;\nexport type EncounterRewards = z.infer<typeof EncounterRewardsSchema>;\nexport type EquipmentReward = z.infer<typeof EquipmentRewardSchema>;\n","/**\n * Data Validation at Startup\n * Validates all game data against Zod schemas before app renders\n */\n\nimport { z } from 'zod';\n\n// Import schemas\nimport { DjinnSchema } from './schemas/DjinnSchema';\nimport { UnitDefinitionSchema } from './schemas/UnitSchema';\nimport { EquipmentSchema } from './schemas/EquipmentSchema';\nimport { EnemySchema } from './schemas/EnemySchema';\nimport { EncounterSchema } from './schemas/EncounterSchema';\n\n// Import data\nimport { DJINN } from './definitions/djinn';\nimport { UNIT_DEFINITIONS } from './definitions/units';\nimport { EQUIPMENT } from './definitions/equipment';\nimport { ENEMIES } from './definitions/enemies';\nimport { ENCOUNTERS } from './definitions/encounters';\n\nexport interface ValidationError {\n  category: string;\n  id: string;\n  errors: string[];\n}\n\nexport interface ValidationResult {\n  valid: boolean;\n  errors: ValidationError[];\n  warnings: string[];\n}\n\n/**\n * Validate a record of items against a schema\n */\nfunction validateRecord<T>(\n  record: Record<string, unknown>,\n  schema: z.ZodType<T>,\n  category: string\n): ValidationError[] {\n  const errors: ValidationError[] = [];\n\n  for (const [id, item] of Object.entries(record)) {\n    const result = schema.safeParse(item);\n    if (!result.success) {\n      errors.push({\n        category,\n        id,\n        errors: result.error.errors.map(e => `${e.path.join('.')}: ${e.message}`),\n      });\n    }\n  }\n\n  return errors;\n}\n\n/**\n * Validate all game data at startup\n */\nexport function validateGameData(): ValidationResult {\n  const errors: ValidationError[] = [];\n  const warnings: string[] = [];\n\n  // Validate Djinn\n  errors.push(...validateRecord(DJINN, DjinnSchema, 'Djinn'));\n\n  // Validate Units\n  errors.push(...validateRecord(UNIT_DEFINITIONS, UnitDefinitionSchema, 'Units'));\n\n  // Validate Equipment\n  errors.push(...validateRecord(EQUIPMENT, EquipmentSchema, 'Equipment'));\n\n  // Validate Enemies\n  errors.push(...validateRecord(ENEMIES, EnemySchema, 'Enemies'));\n\n  // Validate Encounters\n  errors.push(...validateRecord(ENCOUNTERS, EncounterSchema, 'Encounters'));\n\n  // Add warnings for empty collections\n  if (Object.keys(DJINN).length === 0) {\n    warnings.push('No Djinn defined');\n  }\n  if (Object.keys(UNIT_DEFINITIONS).length === 0) {\n    warnings.push('No Units defined');\n  }\n  if (Object.keys(ENEMIES).length === 0) {\n    warnings.push('No Enemies defined');\n  }\n  if (Object.keys(ENCOUNTERS).length === 0) {\n    warnings.push('No Encounters defined');\n  }\n\n  return {\n    valid: errors.length === 0,\n    errors,\n    warnings,\n  };\n}\n\n/**\n * Format validation result for display\n */\nexport function formatValidationResult(result: ValidationResult): string {\n  if (result.valid && result.warnings.length === 0) {\n    return 'All game data validated successfully.';\n  }\n\n  const lines: string[] = [];\n\n  if (!result.valid) {\n    lines.push('DATA VALIDATION FAILED:');\n    lines.push('');\n    for (const error of result.errors) {\n      lines.push(`[${error.category}] ${error.id}:`);\n      for (const msg of error.errors) {\n        lines.push(`  - ${msg}`);\n      }\n    }\n  }\n\n  if (result.warnings.length > 0) {\n    if (lines.length > 0) lines.push('');\n    lines.push('Warnings:');\n    for (const warning of result.warnings) {\n      lines.push(`  - ${warning}`);\n    }\n  }\n\n  return lines.join('\\n');\n}\n","import { render } from 'preact';\nimport { App } from './App';\nimport { GameErrorBoundary } from './ui/components/GameErrorBoundary';\nimport { validateGameData, formatValidationResult } from './data/validateData';\nimport './index.css';\n\n// Bootstrap the game\nconst rootElement = document.getElementById('root');\n\nif (!rootElement) {\n  throw new Error(\n    'Root element not found. Expected element with id=\"root\" in index.html.'\n  );\n}\n\n// Validate game data at startup\nconst validationResult = validateGameData();\n\nif (!validationResult.valid) {\n  // Show user-friendly error screen for data corruption\n  const errorMessage = formatValidationResult(validationResult);\n  console.error('Game data validation failed:', errorMessage);\n\n  render(\n    <div style={{\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'center',\n      justifyContent: 'center',\n      minHeight: '100vh',\n      padding: '2rem',\n      backgroundColor: '#1a1a2e',\n      color: '#fff',\n      fontFamily: 'system-ui, sans-serif',\n    }}>\n      <h1 style={{ fontSize: '2rem', marginBottom: '1rem', color: '#ff6b6b' }}>\n        Game Data Error\n      </h1>\n      <p style={{ fontSize: '1.2rem', marginBottom: '2rem', textAlign: 'center', maxWidth: '600px' }}>\n        Unable to start the game due to corrupted or invalid data.\n        Please try refreshing the page or clearing your browser cache.\n      </p>\n      <details style={{\n        marginBottom: '2rem',\n        padding: '1rem',\n        backgroundColor: '#2a2a3e',\n        borderRadius: '4px',\n        maxWidth: '800px',\n        width: '100%',\n      }}>\n        <summary style={{ cursor: 'pointer', marginBottom: '0.5rem' }}>\n          Technical Details ({validationResult.errors.length} errors)\n        </summary>\n        <pre style={{\n          whiteSpace: 'pre-wrap',\n          wordBreak: 'break-word',\n          fontSize: '0.85rem',\n          color: '#ff6b6b',\n          marginTop: '1rem',\n        }}>\n          {errorMessage}\n        </pre>\n      </details>\n      <button\n        onClick={() => window.location.reload()}\n        style={{\n          padding: '0.75rem 1.5rem',\n          fontSize: '1rem',\n          backgroundColor: '#2196F3',\n          color: '#fff',\n          border: 'none',\n          borderRadius: '4px',\n          cursor: 'pointer',\n          fontWeight: 'bold',\n        }}\n      >\n        Reload Game\n      </button>\n    </div>,\n    rootElement\n  );\n} else {\n  // Log warnings if any\n  if (validationResult.warnings.length > 0) {\n    console.warn('Game data warnings:', validationResult.warnings);\n  }\n\n  // Render app wrapped in ErrorBoundary\n  render(\n    <GameErrorBoundary>\n      <App />\n    </GameErrorBoundary>,\n    rootElement\n  );\n}\n"],"names":["TABS","ELEMENT_COLORS","getElementColor","element","TIER_LABELS","EQUIPMENT_TIER_LABELS","OwnershipBadge","isOwned","jsx","DjinnCard","djinn","elementLower","jsxs","SimpleSprite","stat","value","UnitCard","unit","isRecruited","portraitId","getPortraitSprite","EquipmentCard","equipment","EquipmentIcon","EnemyCard","enemy","spriteId","getEnemyBattleSprite","CompendiumScreen","startTransition","useGameStore","s","activeTab","setActiveTab","useState","selectedIndex","setSelectedIndex","team","roster","ownedEquipment","useStore","collectedDjinnIds","recruitedUnitIds","u","ownedEquipmentIds","e","djinnList","DJINN","d","unitsList","UNIT_DEFINITIONS","enemiesList","ENEMIES","equipmentList","EQUIPMENT","currentList","useEffect","handleKeyPress","event","currentTabIndex","tab","prevTabIndex","prevTab","nextTabIndex","nextTab","prev","renderContent","index","InventoryModal","onClose","gold","selectedItemId","setSelectedItemId","selectedItem","item","isSelected","SettingsModal","musicVolume","setMusicVolume","sfxVolume","setSfxVolume","battleSpeed","setBattleSpeed","showDamageNumbers","setShowDamageNumbers","autoSave","setAutoSave","HowToPlay","TeamSelectWrapper","pendingBattleEncounterId","confirmBattleTeam","returnToOverworld","handleConfirm","handleCancel","PreBattleTeamSelectScreenV2","RewardsWrapper","lastBattleRewards","claimRewards","selectEquipmentChoice","setBattle","towerStatus","setMode","handleRewardsContinue","store","RewardsScreen","ShopWrapper","currentShopId","handleClose","ShopScreen","useStoreSync","mode","showCredits","setShowCredits","setScreen","DevOverlay","screen","modal","App","isTransitioning","openModal","closeModal","state","shallow","setModal","m","isDevMode","setIsDevMode","handleKeyDown","renderScreen","TitleScreen","OverworldMap","QueueBattleView","MainMenu","PartyManagementScreen","DjinnCollectionScreen","TowerHubScreen","CreditsScreen","EpilogueScreen","renderModal","DialogueBox","SaveMenu","PauseMenu","DjinnSummonEffectSchema","z.discriminatedUnion","z.object","z.literal","z.string","z.number","DjinnGrantedAbilitiesSchema","z.array","DjinnSchema","ElementSchema","z.enum","z.record","ContentAvailabilitySchema","EquipmentDropSchema","EquipmentSchema","EnemySchema","StatsSchema","AbilitySchema","EncounterRulesSchema","equipmentOptionsUnique","options","EquipmentRewardSchema","EncounterRewardsSchema","EncounterSchema","validateRecord","record","schema","category","errors","id","result","validateGameData","warnings","UnitDefinitionSchema","ENCOUNTERS","formatValidationResult","lines","error","msg","warning","rootElement","validationResult","render","GameErrorBoundary","errorMessage"],"mappings":"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"}